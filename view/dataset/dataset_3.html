<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    />
    <link rel="stylesheet" href="../style.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <title>Bootstrap Sidebar</title>
  </head>

  <body class="d-flex">
    <div id="sidebar" class="bg-dark text-white d-flex flex-column">
      <div id="logo">
        <img src="../../assets/logo.png" alt="Logo" />
        <span class="ms-3">SDGs Dashboard</span>
      </div>
      <ul class="nav flex-column">
        <li class="nav-item">
          <a
            class="nav-link text-white d-flex align-items-center p-3"
            href="#"
            id="pict"
          >
            <img src="../../assets/3.png" alt="" />
            <span class="ms-3">Kehidupan sehat & <br />Sejahtera</span>
          </a>
        </li>
        <li class="nav-item">
          <a
            class="nav-link text-white d-flex align-items-center p-3"
            href="#"
            id="pict"
          >
            <img src="../../assets/4.png" alt="" />
            <span class="ms-3">Pendidikan Bermutu</span>
          </a>
        </li>
        <li class="nav-item">
          <a
            class="nav-link text-white d-flex align-items-center p-3"
            href="#"
            id="pict"
          >
            <img src="../../assets/6.png" alt="" />
            <span class="ms-3">Air bersih & <br />Sanitasi Layak</span>
          </a>
        </li>
        <li class="nav-item">
          <a
            class="nav-link text-white d-flex align-items-center p-3"
            href="../view/dataset/tema_3/dataset_3.html"
          >
            <i class="fa fa-database"></i>
            <span class="ms-3">Database</span>
          </a>
        </li>
      </ul>
    </div>
    <div id="content" class="flex-grow p-4">
      <div class="d-flex align-items-center mb-4">
        <button class="btn btn-dark me-3" id="toggleSidebar">
          <i class="fas fa-bars"></i>
        </button>
        <h3 class="fw-bold">Welcome to SDGs Dashboard</h3>
      </div>

      <!-- Indicators Section -->
      <div class="card">
        <h4 class="text-center fw-bold mt-4">Indikator</h4>
        <div class="card-body">
          <div class="indicators-container">
            <div class="indicators">
              <div class="indicator">
                <h5>3.1.1</h5>
                <div class="radio-group">
                  <input
                    type="radio"
                    name="indicator"
                    id="indicator1"
                    value="3.1.1"
                  />
                  <label for="indicator1"></label>
                </div>
              </div>
              <div class="indicator">
                <h5>3.2.1</h5>
                <div class="radio-group">
                  <input
                    type="radio"
                    name="indicator"
                    id="indicator1"
                    value="3.2.1"
                  />
                  <label for="indicator1"></label>
                </div>
              </div>
              <div class="indicator">
                <h5>1.3</h5>
                <div class="radio-group">
                  <input type="radio" name="indicator" id="indicator3" />
                  <label for="indicator3"></label>
                </div>
              </div>
              <div class="indicator">
                <h5>1.4</h5>
                <div class="radio-group">
                  <input type="radio" name="indicator" id="indicator4" />
                  <label for="indicator4"></label>
                </div>
              </div>
              <div class="indicator">
                <h5>1.5</h5>
                <div class="radio-group">
                  <input type="radio" name="indicator" id="indicator5" />
                  <label for="indicator5"></label>
                </div>
              </div>
              <div class="indicator">
                <h5>1.6</h5>
                <div class="radio-group">
                  <input type="radio" name="indicator" id="indicator6" />
                  <label for="indicator6"></label>
                </div>
              </div>
              <div class="indicator">
                <h5>1.7</h5>
                <div class="radio-group">
                  <input type="radio" name="indicator" id="indicator7" />
                  <label for="indicator7"></label>
                </div>
              </div>
              <div class="indicator">
                <h5>1.8</h5>
                <div class="radio-group">
                  <input type="radio" name="indicator" id="indicator8" />
                  <label for="indicator8"></label>
                </div>
              </div>
              <div class="indicator">
                <h5>1.9</h5>
                <div class="radio-group">
                  <input type="radio" name="indicator" id="indicator9" />
                  <label for="indicator9"></label>
                </div>
              </div>
              <div class="indicator">
                <h5>1.10</h5>
                <div class="radio-group">
                  <input type="radio" name="indicator" id="indicator10" />
                  <label for="indicator10"></label>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- End of Indicators Section -->

      <div class="d-flex">
        <div class="chart-container flex-grow-1">
          <h6>
            Tingkat penyelesaian pendidikan jenjang SD/sederajat, SMP/sederajat,
            dan SMA/sederajat. <span class="increase">â†‘ 4% more in 2022</span>
          </h6>
          <canvas id="salesChart"></canvas>
        </div>

        <!-- Vertical Indicators Section -->
        <div class="vertical-indicators ms-4">
          <div class="indicator">
            <h5>2016</h5>
            <h6>11.25</h6>
            <h6>Persen</h6>
          </div>
          <div class="indicator">
            <h5>2016</h5>
            <h6>11.25</h6>
            <h6>Persen</h6>
          </div>
          <div class="indicator">
            <h5>2016</h5>
            <h6>11.25</h6>
            <h6>Persen</h6>
          </div>
        </div>
        <!-- End of Vertical Indicators Section -->
      </div>

      <h4 class="mt-5 text-center">Indicator Data</h4>
      <div id="alertContainer"></div>
      <table class="table mt-3">
        <thead>
          <tr>
            <th>No</th>
            <th>Tahun</th>
            <th>Deskripsi</th>
            <th>Value</th>
            <th>Sumber</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="indicatorData">
          <!-- Data will go here -->
        </tbody>
      </table>

      <!-- Add Flight Modal -->
      <div
        class="modal fade"
        id="addFlightModal"
        tabindex="-1"
        role="dialog"
        aria-labelledby="addFlightModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="addFlightModalLabel">
                Add Flight Ticket
              </h5>
              <button
                type="button"
                class="close"
                data-dismiss="modal"
                aria-label="Close"
              >
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <form id="addFlightForm">
                <div class="form-group">
                  <label for="addName">Airline Name</label>
                  <input
                    type="text"
                    class="form-control"
                    id="addName"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="addOrigin">Origin</label>
                  <input
                    type="text"
                    class="form-control"
                    id="addOrigin"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="addDestination">Destination</label>
                  <input
                    type="text"
                    class="form-control"
                    id="addDestination"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="addDepartureTime">Departure Time</label>
                  <input
                    type="datetime-local"
                    class="form-control"
                    id="addDepartureTime"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="addArrivalTime">Arrival Time</label>
                  <input
                    type="datetime-local"
                    class="form-control"
                    id="addArrivalTime"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="addPrice">Price</label>
                  <input
                    type="number"
                    class="form-control"
                    id="addPrice"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="addSeats">Seats Available</label>
                  <input
                    type="number"
                    class="form-control"
                    id="addSeats"
                    required
                  />
                </div>
                <button type="submit" class="btn btn-primary">
                  Add Flight
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- Edit Modal -->
      <div
        class="modal fade"
        id="editModal"
        tabindex="-1"
        role="dialog"
        aria-labelledby="editModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="editModalLabel">
                Edit Flight Ticket
              </h5>
              <button
                type="button"
                class="close"
                data-dismiss="modal"
                aria-label="Close"
              >
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <form id="editForm">
                <div class="form-group">
                  <label for="editName">Year</label>
                  <input
                    type="text"
                    class="form-control"
                    id="editName"
                    placeholder=""
                  />
                </div>
                <div class="form-group">
                  <label for="editDeparture">Description</label>
                  <input
                    type="text"
                    class="form-control"
                    id="editDeparture"
                    placeholder=""
                  />
                </div>
                <div class="form-group">
                  <label for="editArrival">Value</label>
                  <input
                    type="text"
                    class="form-control"
                    id="editArrival"
                    placeholder=""
                  />
                </div>
                <div class="form-group">
                  <label for="editSource">Source</label>
                  <textarea
                    class="form-control"
                    id="editSource"
                    placeholder=""
                  ></textarea>
                </div>
                <button type="submit" class="btn btn-primary mt-2">
                  Save changes
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- Delete Modal -->
      <div
        class="modal fade"
        id="deleteModal"
        tabindex="-1"
        role="dialog"
        aria-labelledby="deleteModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="deleteModalLabel">
                Delete Flight Ticket
              </h5>
              <button
                type="button"
                class="close"
                data-dismiss="modal"
                aria-label="Close"
              >
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              Are you sure you want to delete this flight ticket?
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-dismiss="modal"
              >
                Cancel
              </button>
              <button type="button" class="btn btn-danger" id="confirmDelete">
                Delete
              </button>
            </div>
          </div>
        </div>
      </div>

      <script>
        let indicatorData = [];
        let flightDataArray = [];
        let currentEditIndex = -1;
        let currentDeleteIndex = -1;

        document.addEventListener("DOMContentLoaded", function () {
          const radioButtons = document.querySelectorAll(
            'input[name="indicator"]'
          );
          radioButtons.forEach((radio) => {
            radio.addEventListener("change", function () {
              const selectedIndicator = this.value;
              fetchTableData(selectedIndicator);
            });
          });

          function fetchTableData(indicator) {
            fetch(`../../data/getTableData.php?indicator=${indicator}`)
              .then((response) => response.json())
              .then((data) => {
                indicatorData = data;
                flightDataArray = data;
                updateTable(data);
              })
              .catch((error) => {
                console.error("Error fetching table data:", error);
              });
          }
        });

        // Load Data
        function updateTable(data) {
          const indicatorData = document.getElementById("indicatorData");
          indicatorData.innerHTML = "";
          data.forEach((row, index) => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${index + 1}</td>
              <td>${row.year}</td>
              <td>${row.description}</td>
              <td>${row.value}</td>
              <td>${row.source}</td>
              <td>
                  <button class="btn btn-primary" data-toggle="modal" data-target="#editModal" onclick="editFlight(${index})">
                      <img src="../../assets/edit.png" alt="Edit" style="width: 20px; height: 20px;">
                  </button>
                  <button class="btn btn-danger" data-toggle="modal" data-target="#deleteModal" onclick="deleteFlight(${index})">
                      <img src="../../assets/delete.png" alt="Delete" style="width: 20px; height: 20px;">
                  </button>
              </td>

            `;
            indicatorData.appendChild(tr);
          });
        }

        // Add Flight
        document.getElementById("addFlightForm").addEventListener("submit", function (event) {
            event.preventDefault();
            const newFlight = {
              goal: "3",
              target : "3.1",
              indicator: "3.1.1",
              seriesCode: "SH_STA_ACSN",
              seriesDesc: "Proportion of population with primary reliance on clean fuels and technology",
              geoAreaCode: "1",
              geoAreaName: "Afghanistan",
              timePeriod: "2010",
              value: "26.2",
              time_Detail: "2010",
              source: "World Bank",
              // year: document.getElementById("addName").value,
              // description: document.getElementById("addDeparture").value,
              // value: document.getElementById("addArrival").value,
              // source: document.getElementById("addSource").value,
            };

            fetch("../../data/ticket/flight/add_flight_ticket.php", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ flight: newFlight }),
            })
              .then((response) => response.json())
              .then((data) => {
                if (data.success) {
                  flightDataArray.push(newFlight);
                  populateFlightTable(flightDataArray);
                  $("#addFlightModal").modal("hide");
                  document.getElementById("alertContainer").innerHTML =
                    '<div class="alert alert-success" role="alert">Flight added successfully!</div>';
                } else {
                  console.error("Error adding flight data:", data.error);
                  document.getElementById("alertContainer").innerHTML =
                    '<div class="alert alert-danger" role="alert">Failed to add flight data.</div>';
                }
              })
              .catch((error) => {
                console.error("Error adding flight data:", error);
                document.getElementById("alertContainer").innerHTML =
                  '<div class="alert alert-danger" role="alert">Failed to add flight data.</div>';
              });
          });

        // Edit Function
        function editFlight(index) {
          currentEditIndex = index;
          const flight = flightDataArray[index];
          document.getElementById("editName").value = flight.year;
          document.getElementById("editDeparture").value = flight.description;
          document.getElementById("editArrival").value = flight.value;
          document.getElementById("editSource").value = flight.source;
        }

        document.getElementById("editForm").addEventListener("submit", function (event) {
            event.preventDefault();
            const updatedFlight = {
              _id: flightDataArray[currentEditIndex]._id,
              year: document.getElementById("editName").value,
              description: document.getElementById("editDeparture").value,
              value: document.getElementById("editArrival").value,
              source: document.getElementById("editSource").value,
            };

            fetch("../../data/updateData.php", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                index: currentEditIndex,
                flight: updatedFlight,
              }),
            })
              .then((response) => response.json())
              .then((data) => {
                if (data.success) {
                  flightDataArray[currentEditIndex] = updatedFlight;
                  updateTable(flightDataArray);
                  $("#editModal").modal("hide");
                  document.getElementById("alertContainer").innerHTML =
                    '<div class="alert alert-success" role="alert">Flight updated successfully!</div>';
                } else {
                  console.error("Error updating flight data:", data.error);
                  document.getElementById("alertContainer").innerHTML =
                    '<div class="alert alert-danger" role="alert">Failed to update flight data.</div>';
                }
              })
              .catch((error) => {
                console.error("Error updating flight data:", error);
                document.getElementById("alertContainer").innerHTML =
                  '<div class="alert alert-danger" role="alert">Failed to update flight data.</div>';
              });
          }
        );
        // End of Edit Function

        // Delete Function
        function deleteFlight(index) {
          currentDeleteIndex = index;
        }

        document.getElementById("confirmDelete").onclick = function () {
          const flightToDelete = flightDataArray[currentDeleteIndex];

          fetch("../../data/deleteData.php", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ _id: flightToDelete._id }),
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                flightDataArray.splice(currentDeleteIndex, 1);
                updateTable(flightDataArray);
                $("#deleteModal").modal("hide");
                document.getElementById("alertContainer").innerHTML =
                  '<div class="alert alert-success" role="alert">Flight deleted successfully!</div>';
              } else {
                console.error("Error deleting flight data:", data.error);
                document.getElementById("alertContainer").innerHTML =
                  '<div class="alert alert-danger" role="alert">Failed to delete flight data.</div>';
              }
            })
            .catch((error) => {
              console.error("Error deleting flight data:", error);
              document.getElementById("alertContainer").innerHTML =
                '<div class="alert alert-danger" role="alert">Failed to delete flight data.</div>';
            });
        };
        // End of Delete Function
      </script>

      <script>
        const ctx = document.getElementById("salesChart").getContext("2d");
        const salesChart = new Chart(ctx, {
          type: "line",
          data: {
            labels: [
              "Apr",
              "May",
              "Jun",
              "Jul",
              "Aug",
              "Sep",
              "Oct",
              "Nov",
              "Dec",
            ],
            datasets: [
              {
                label: "Sales",
                data: [200, 300, 400, 500, 400, 300, 200, 300, 400],
                borderColor: "rgba(0, 204, 255, 1)",
                backgroundColor: "rgba(0, 204, 255, 0.2)",
                fill: true,
                tension: 0.4, // Smooth the line
                hoverBorderColor: "rgba(255, 99, 132, 1)", // Change border color on hover
                hoverBackgroundColor: "rgba(255, 99, 132, 0.2)", // Change background color on hover
              },
            ],
          },
          options: {
            responsive: true,
            scales: {
              y: {
                beginAtZero: true,
                title: {
                  display: true,
                },
              },
              x: {
                title: {
                  display: true,
                  text: "Months",
                },
              },
            },
            plugins: {
              legend: {
                display: false, // Hide the legend
              },
              tooltip: {
                enabled: true, // Enable tooltips
                mode: "index", // Show tooltip for all points at the hovered index
                intersect: false, // Allow tooltip to show for all points
                backgroundColor: "rgba(0, 0, 0, 0.7)", // Tooltip background color
                titleColor: "#fff", // Tooltip title color
                bodyColor: "#fff", // Tooltip body color
                borderColor: "rgba(255, 255, 255, 0.5)", // Tooltip border color
                borderWidth: 1, // Tooltip border width
              },
            },
          },
        });
      </script>
    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script> -->
    <script>
      document
        .getElementById("toggleSidebar")
        .addEventListener("click", function () {
          document.getElementById("sidebar").classList.toggle("collapsed");
        });
    </script>
  </body>
</html>
